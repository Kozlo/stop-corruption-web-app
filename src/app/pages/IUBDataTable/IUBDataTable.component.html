<div class="row">
  <div class="col-12">
    <button class="btn btn-link py-0" (click)="showHelp = !showHelp">
      <ng-container *ngIf="!showHelp">Pal朝dz朝ba +</ng-container>
      <ng-container *ngIf="showHelp">Pal朝dz朝ba -</ng-container>
    </button><br />

    <img src="../../../assets/attels-1.jpeg" *ngIf="showHelp" />
  </div>
  <div class="col-12">
    <h4>Filters</h4>

    <div class="row">
      <!-- Limit Filter -->
      <div class="col-12 col-md-4">
        <div class="form-group">
          <label for="limit">Limit</label>
          <select [(ngModel)]="limit" class="form-control" (change)="retrieveProcurement()">
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="50">50</option>
            <option value="100">100</option>
            <option value="500">500</option>
          </select>
        </div>
      </div>

      <!-- Price from filter -->
      <div class="col-12 col-md-4">
        <div class="form-group">
          <label for="price-from">Min Price</label>
          <input type="number" id="price-from" [(ngModel)]="priceFrom" class="form-control" />
        </div>
      </div>

      <!-- Price to filter -->
      <div class="col-12 col-md-4">
        <div class="form-group">
          <label for="price-to">Max Price</label>
          <input type="number" id="price-to" [(ngModel)]="priceTo" class="form-control" />
        </div>
      </div>

      <!-- Tender count from filter -->
      <div class="col-12 col-md-4">
        <div class="form-group">
          <label for="tender-count-from">Tender count From</label>
          <input type="number" id="tender-count-from" [(ngModel)]="tenderCountFrom" class="form-control" />
        </div>
      </div>

      <!-- Tender count to filter -->
      <div class="col-12 col-md-4">
        <div class="form-group">
          <label for="tender-count-to">Tender count To</label>
          <input type="number" id="tender-count-to" [(ngModel)]="tenderCountTo" class="form-control" />
        </div>
      </div>
      
      <!-- Tender count to filter -->
      <div class="col-12 col-md-4">
        <div class="form-group">
          <label for="authority-name">Authority Name</label>
          <input type="text" id="authority-name" [(ngModel)]="authorityName" class="form-control" />
        </div>
      </div>

      <!-- Apply filters -->
      <div class="col-12">
        <button class="btn btn-primary float-right" (click)="retrieveProcurement()">Apply Filters</button>
      </div>
    </div>
  </div>
  <div class="col-12">
    <h4>Procurements</h4>
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th class="pointer" (click)="setSorting('document_id')">
              IUB Document ID
              <ng-container *ngIf="sortBy === 'document_id'">
                <ng-container *ngIf="sortDirection === 1">
                  <span class="material-icons">arrow_upwards</span>
                </ng-container>

                <ng-container *ngIf="sortDirection === -1">
                  <span class="material-icons">arrow_downwards</span>
                </ng-container>
              </ng-container>
            </th>
            <th class="pointer" (click)="setSorting('authority_name')">
              Authority Name
              <ng-container *ngIf="sortBy === 'authority_name'">
                <ng-container *ngIf="sortDirection === 1">
                  <span class="material-icons">arrow_upwards</span>
                </ng-container>

                <ng-container *ngIf="sortDirection === -1">
                  <span class="material-icons">arrow_downwards</span>
                </ng-container>
              </ng-container>
            </th>
            <th class="pointer" (click)="setSorting('authority_reg_num')">
              Authority Registration Number
              <ng-container *ngIf="sortBy === 'authority_reg_num'">
                <ng-container *ngIf="sortDirection === 1">
                  <span class="material-icons">arrow_upwards</span>
                </ng-container>

                <ng-container *ngIf="sortDirection === -1">
                  <span class="material-icons">arrow_downwards</span>
                </ng-container>
              </ng-container>
            </th>
            <th>
              Winners
              <!--<ng-container *ngIf="sortBy === 'winner_name'">-->
                <!--<ng-container *ngIf="sortDirection === 1">-->
                  <!--<span class="material-icons">arrow_upwards</span>-->
                <!--</ng-container>-->

                <!--<ng-container *ngIf="sortDirection === -1">-->
                  <!--<span class="material-icons">arrow_downwards</span>-->
                <!--</ng-container>-->
              <!--</ng-container>-->
            </th>
            <th>
              <span>Winner Registration Dates</span>
            </th>
            <th class="pointer" (click)="setSorting('decision_date')">
              Decision Date
              <ng-container *ngIf="sortBy === 'decision_date'">
                <ng-container *ngIf="sortDirection === 1">
                  <span class="material-icons">arrow_upwards</span>
                </ng-container>

                <ng-container *ngIf="sortDirection === -1">
                  <span class="material-icons">arrow_downwards</span>
                </ng-container>
              </ng-container>
            </th>
            <th class="pointer" (click)="setSorting('price')">
              Contract Price
              <ng-container *ngIf="sortBy === 'price'">
                <ng-container *ngIf="sortDirection === 1">
                  <span class="material-icons">arrow_upwards</span>
                </ng-container>

                <ng-container *ngIf="sortDirection === -1">
                  <span class="material-icons">arrow_downwards</span>
                </ng-container>
              </ng-container>
            </th>
            <th class="pointer" (click)="setSorting('currency')">
              Currency
              <ng-container *ngIf="sortBy === 'currency'">
                <ng-container *ngIf="sortDirection === 1">
                  <span class="material-icons">arrow_upwards</span>
                </ng-container>

                <ng-container *ngIf="sortDirection === -1">
                  <span class="material-icons">arrow_downwards</span>
                </ng-container>
              </ng-container>
            </th>
            <th class="pointer" (click)="setSorting('price_from')">
              Price From
              <ng-container *ngIf="sortBy === 'price_from'">
                <ng-container *ngIf="sortDirection === 1">
                  <span class="material-icons">arrow_upwards</span>
                </ng-container>

                <ng-container *ngIf="sortDirection === -1">
                  <span class="material-icons">arrow_downwards</span>
                </ng-container>
              </ng-container>
            </th>
            <th class="pointer" (click)="setSorting('price_to')">
              Price To
              <ng-container *ngIf="sortBy === 'price_to'">
                <ng-container *ngIf="sortDirection === 1">
                  <span class="material-icons">arrow_upwards</span>
                </ng-container>

                <ng-container *ngIf="sortDirection === -1">
                  <span class="material-icons">arrow_downwards</span>
                </ng-container>
              </ng-container>
            </th>
            <th class="pointer" (click)="setSorting('tender_num')">
              Tender Count
              <ng-container *ngIf="sortBy === 'tender_num'">
                <ng-container *ngIf="sortDirection === 1">
                  <span class="material-icons">arrow_upwards</span>
                </ng-container>

                <ng-container *ngIf="sortDirection === -1">
                  <span class="material-icons">arrow_downwards</span>
                </ng-container>
              </ng-container>
            </th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngIf="IUBData.length === 0">
            <tr>
              <td colspan="7" class="text-center">No records were found that match the specified search criteria</td>
            </tr>
          </ng-container>
          <ng-container *ngIf="IUBData.length > 0">
            <tr *ngFor="let row of IUBData">
              <td>
                <a href="https://pvs.iub.gov.lv/show/{{ row.document_id }}" target="_blank">{{ row.document_id }}</a>
              </td>
              <td>{{ row.authority_name }}</td>
              <td>{{ row.authority_reg_num }}</td>
              <td>
                <ng-container *ngFor="let winner of row.winners">
                  <a *ngIf="winner.winner_reg_num" target="_blank" href="https://company.lursoft.lv/{{ winner.winner_reg_num}}">{{ winner.winner_name }} ({{ winner.winner_reg_num }})</a>
                  <span *ngIf="!winner.winner_reg_num" >{{ winner.winner_name }}</span>
                </ng-container>
              </td>
              <td>
                <ng-container *ngFor="let winner of row.winners">
                  <span *ngIf="winner.winner_reg_date" >{{ winner.winner_reg_date }}</span>
                </ng-container>
              </td>
              <td>
                <ng-container *ngIf="row.decision_date; else noValue">
                  {{ row.decision_date }}
                </ng-container>
              </td>
              <td>
                <ng-container *ngIf="row.price; else noValue">
                  <span *ngIf="row.currency === 2">&#8364;</span><span>{{ row.price | number:'1.2-2' }}</span>
                </ng-container>
              </td>
              <td>
                <ng-container *ngIf="row.currency; else noValue">
                  <span *ngIf="row.currency === 1">LVL</span>
                  <span *ngIf="row.currency === 2">EUR</span>
                </ng-container>
              </td>
              <td>
                <ng-container *ngIf="row.price_from; else noValue">
                  <span *ngIf="row.currency === 2">&#8364;</span><span>{{ row.price_from | number:'1.2-2' }}</span>
                </ng-container>
              </td>
              <td>
                <ng-container *ngIf="row.price_to; else noValue">
                  <span *ngIf="row.currency === 2">&#8364;</span><span>{{ row.price_to | number:'1.2-2' }}</span>
                </ng-container>
              </td>
              <td>
                <ng-container *ngIf="row.tender_num; else noValue">
                  {{ row.tender_num }}
                </ng-container>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Authority data modal -->
<div class="modal fade" id="winnerDataModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Winner Data</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        ...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<ng-template #noValue>
  -
</ng-template>
